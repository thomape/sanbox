<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Web App Setup - Vue.js + FastAPI + Postgres</h1>
    <h2>Overview</h2>
    <p>
        This guide will walk you through the process of setting up a frontend and
        backend web app. To follow this guide accurately it is highly recommended to
        reproduce the development environment exactly as to minimize any installation
        issues.
    </p>
    <p>
        This guide relies on some level of competency utilizing Linux based operating
        systems. For more help check out -
        <a href="https://ubuntu.com/tutorials/command-line-for-beginners#3-opening-a-terminal"
            title="https://ubuntu.com/tutorials/command-line-for-beginners#3-opening-a-terminal">Ubuntu Basics</a>
    </p>
    <hr />
    <h2>Section 1: Development Environment Setup</h2>
    <h3>1.1 <strong>Windows</strong></h3>
    <ol>
        <li>
            Visual Studio Code -
            <a href="https://code.visualstudio.com/download" title="https://code.visualstudio.com/download">VSCode
                download</a>
        </li>
        <li>
            Windows Terminal -
            <a href="https://www.microsoft.com/store/productId/9N0DX20HK701"
                title="https://www.microsoft.com/store/productId/9N0DX20HK701">Windows Terminal download</a>
        </li>
        <li>
            Windows Subsystem for Linux (WSL2) -
            <a href="https://docs.microsoft.com/en-us/windows/wsl/install"
                title="https://docs.microsoft.com/en-us/windows/wsl/install">WSL2 Setup</a>
        </li>
        <li>
            Ubuntu -
            <a href="https://www.microsoft.com/store/productId/9PDXGNCFSCZV"
                title="https://www.microsoft.com/store/productId/9PDXGNCFSCZV">Ubuntu download</a>
        </li>
    </ol>
    <h3>1.2 <strong>Ubuntu</strong></h3>
    <p>From terminal run the following commands:</p>
    <ol>
        <li><code>sudo apt update</code></li>
        <li><code>sudo snap install --classic code</code></li>
    </ol>
    <h3>1.3 <strong>Mac</strong></h3>
    <p>
        No steps at this time, however following along the linux instructions will
        more than likely get everything setup correctly.
    </p>
    <h3>1.4 <strong>VirtualBox</strong></h3>
    <ol>
        <li>
            Download VirtualBox -
            <a href="https://www.virtualbox.org/wiki/Downloads"
                title="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>
        </li>
        <li>
            Download Ubuntu -
            <a href="https://ubuntu.com/download/desktop" title="https://ubuntu.com/download/desktop">Ubuntu</a>
        </li>
        <li>Run Virtualbox and select "New".</li>
        <li>Add name</li>
        <li>Under "Type" select "Linux".</li>
        <li>Under "Version" select "Ubuntu(64-bit)"</li>
        <li>Increase Memory size to 2048</li>
        <li>Create</li>
        <li>Increase disk size to 25GB</li>
        <li>Create</li>
        <li>Goto Settings &gt; System &gt; Processor - increase to 2.</li>
        <li>
            Goto Settings &gt; Display &gt; Video memory - increase to 64mb or 128mb
        </li>
        <li>Goto Settings &gt; Storage - Click the disk icon that says "Empty".</li>
        <li>
            Click the other disk icon on the right and browse to the Ubuntu image just
            downloaded.
        </li>
        <li>Click "OK"</li>
        <li>Click "Start"</li>
        <li>"Try or install Ubuntu"</li>
    </ol>
    <h3>1.5 <strong>VS Code Extensions</strong></h3>
    <p>
        There are several extensions that will all for better development practice
        that can be installed from within VS Code. From the the extensions tab search
        and install the following.
    </p>
    <ol>
        <li>ESLint</li>
        <li>GitLens</li>
        <li>HTML CSS Support</li>
        <li>Prettier - Code Formatter</li>
        <li>Python</li>
        <li>Vue Language Features(Volar)</li>
    </ol>
    <hr />
    <h2>Section 2: Project Folder Structure</h2>
    <h3>2.1 <strong>Setup Project Structure</strong></h3>
    <p>
        This is a basic project folder structure that will be used throughout the
        project. Git is also being setup at this phase so some familiarity with Git
        and its basic commands is advisable. -
        <a href="https://git-scm.com/book/en/v2/Git-Basics-Getting-a-Git-Repository"
            title="https://git-scm.com/book/en/v2/Git-Basics-Getting-a-Git-Repository">Git Basics</a>
    </p>
    <p>
        From the terminal run the following commands:
    <ol>
        <li><code>sudo apt install git -y</code> </li>
        <li><code>git --version</code> - If there is a version number Git is installed. </li>
        <li><code>mkdir ~/projects ~/venv</code> </li>
        <li><code>cd ~/projects</code> </li>
        <li><code>mkdir new_project_name &amp;&amp; cd new_project_name</code> </li>
        <li><code>mkdir backend</code> </li>
        <li><code>touch readme.md</code> </li>
        <li><code>git init</code></li>
        <li><code>git branch -m main</code></li>
    </ol>
    </p>
    <p>
        This will design the basic folder structure for a new project. It will also
        initialize the new project to use Git as a versioning control provision.
    </p>
    <hr />
    <h2>Section 3: Project Setup and Creation - Front End</h2>
    <h3>3.1 <strong>Front End Setup</strong></h3>
    <p>
        The frontend will use Vue.js as the Javascript framework and Bulma as the CSS
        framework. The following are required to setup the frontend.
        <li>Node.js </li>
        <li>Server-side JS framework. Required for Vue </li>
        <li>npm - Node.js package manager </li>
        <li>Vue.js </li>
        <li>Client-side JS framework </li>
        <li>Bulma - CSS framework</li>
    </p>
    <p>
        From the terminal run the following commands:
    <ol>
        <li><code>sudo apt install nodejs npm -y</code> </li>
        <li><code>npm install -g @vue/cli</code> </li>
        <li><code>node --version &amp;&amp; npm --version</code> - If there are version numbers Node and npm are
            installed. </li>
        <li><code>sudo npm install -g @vue/cli</code> 5. <code>vue --version</code> - If there is a version number Vue
            is installed.</li>
    </ol>
    </p>
    <h3>3.2 <strong>Front End Creation</strong></h3>
    <p>
        Ensure that you are in the new projects root directory before completing the
        steps below. For further information about Vue.js use their documentation.
        <a href="https://vuejs.org/guide/introduction.html" title="https://vuejs.org/guide/introduction.html">Vue
            Docs</a>
    </p>
    <p>
        3.2.1 <strong>Vue Project Creation</strong>
    </p>
    <ol>
        <li><code>vue create new_frontend_app</code> </li>
        <li> Select the option to "Manually select features". Hit Enter. </li>
        <li> Ensure the options "Babel" and "Linter/Formatter" are selected. Hit Enter. </li>
        <li>Select Vue "3.x". Hit Enter.</li>
        <li>Select "ESLint + Prettier". Hit Enter.</li>
        <li> Select "Lint on Save". Hit Enter. </li>
        <li> Select "In package.json". Hit Enter. </li>
        <li> Save as preset. User can decide if they wish to save preset.<br /></li>
        <em>Note: Vue will take a moment to generate the project. If any errors occur
            during the creation process they will need to be addressed prior to moving
            forward.</em>
        <li><code>cd new_frontend_app</code></li>
        <li><code>npm run serve</code> </li>
        <li>Open a browser and go to "localhost:8080". Vue will have some boilerplate displayed.</li>
        <li>Press <code>ctrl -c</code> to cancel the app server.</li>
    </ol>
    <p>
        3.2.2 <strong>Vue Project Clean-up</strong>
    </p>
    <ol>
        <li>Type <code>sudo rm -rf .git</code> from within the Vue project folder. This will delete the git repo that Vue created. </li>
        <li>Type <code>code .</code> from within the Vue project folder. This will open the project in VS Code. </li>
        <li>Under new_frontend_app &gt; src &gt; assets - delete logo.png </li>
        <li>Under new_frontend_app &gt; src &gt; components - Rename "HelloWorld.vue" to "HomeComp.vue" and remove all of the code from within the "template" element. Also, delete the "script" and "style" blocks. </li>
        <li>Insert a "div" under "template" and add "HomeComp" as the text. </li>
        <li>Under new_frontend_app &gt; src &gt; App.vue anywhere it says "HelloWorld" replace with "HomeComp" </li>
        <li>Delete "img" element </li>
        <li>Remove "msg" from "HomeComp" element </li>
        <li>Delete "style" block</li>
        <li>Run <code>npm run serve</code> and refresh page in browser to see changes.</li>
    </ol>
    <h3>3.3 <strong>Bulma Installation and Setup</strong></h3>
    <p>
        The next steps will go over how to install Bulma and configure it for
        customization.
    </p>
    <ol>
        <li>
            From within new_frontend_app root folder run:
            <code>npm install --save-dev node-sass sass-loader bulma</code>
        </li>
        <li>
            After installation is complete check package.json to ensure all three
            packages are now installed.
        </li>
        <li>
            Within the <code>assets</code> folder create a file called
            <code>mystyles.scss</code>
        </li>
        <li>
            <p>
                In <code>mystyles.scss</code> add <code>@import "~bulma"</code>. This will
                import the default styling Bulma offers. If custom styling is desired, the
                following code must be used instead. This is an example of how to modify
                themes. Use Bulma's documentation for further information.
                <a href="https://bulma.io/documentation/" title="https://bulma.io/documentation/">Bulma Docs</a>
            </p>
            <pre><code>// @import "~bulma"
    
    @charset "utf-8";
    
    // Import a Google Font
    @import url("https://fonts.googleapis.com/css?family=Nunito:400,700");
    
    // Set your brand colors
    $purple: #8A4D76;
    $pink: #FA7C91;
    $brown: #757763;
    $beige-light: #D0D1CD;
    $beige-lighter: #EFF0EB;
    
    // Update Bulma's global variables
    $family-sans-serif: "Nunito", sans-serif;
    $grey-dark: $brown;
    $grey-light: $beige-light;
    $primary: $purple;
    $link: $pink;
    $widescreen-enabled: false;
    $fullhd-enabled: false;
    
    // Update some of Bulma's component variables
    $body-background-color: $beige-lighter;
    $control-border-width: 2px;
    $input-border-color: transparent;
    $input-shadow: none;
    
    // Import only what you need from Bulma
    @import "~bulma/sass/utilities/_all.sass";
    @import "~/node_modules/bulma/sass/base/_all.sass";
    @import "~/node_modules/bulma/sass/base/_all.sass";
    @import "~/node_modules/bulma/sass/elements/button.sass";
    @import "~/node_modules/bulma/sass/elements/container.sass";
    @import "~/node_modules/bulma/sass/elements/title.sass";
    @import "~/node_modules/bulma/sass/form/_all.sass";
    @import "~/node_modules/bulma/sass/components/navbar.sass";
    @import "~/node_modules/bulma/sass/layout/hero.sass";
    @import "~/node_modules/bulma/sass/layout/section.sass";
    </code></pre>
        </li>
        <li>
            <p>
                Open <code>main.js</code> and add the following under the last import.
                <code>require("@/assets/mystyles.scss")</code>
            </p>
        </li>
        <li>
            Add the code below to the "template" section in "HomeComp"
            <pre><code>&lt;body&gt;
        &lt;h1 class="title"&gt;
            Bulma
        &lt;/h1&gt;
    
        &lt;p class="subtitle"&gt;
            Modern CSS framework based on &lt;a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox"&gt;Flexbox&lt;/a&gt;
        &lt;/p&gt;
    
        &lt;div class="field"&gt;
            &lt;div class="control"&gt;
            &lt;input class="input" type="text" placeholder="Input"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    
        &lt;div class="field"&gt;
            &lt;p class="control"&gt;
            &lt;span class="select"&gt;
                &lt;select&gt;
                &lt;option&gt;Select dropdown&lt;/option&gt;
                &lt;/select&gt;
            &lt;/span&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    
        &lt;div class="buttons"&gt;
            &lt;a class="button is-primary"&gt;Primary&lt;/a&gt;
            &lt;a class="button is-link"&gt;Link&lt;/a&gt;
        &lt;/div&gt;
    &lt;/body&gt;
    </code></pre>
        </li>
        <li><code>npm run serve</code> - Check for changes in styling.</li>
    </ol>
    <h2>Section 4: Project Setup and Creation - Back End</h2>
    <h3>4.1 <strong>Back End Setup</strong></h3>
    <p>
        The backend will use Python as the primary language and pip as the package
        manager. The project will also utilize python virtual environments to
        containerize the packages that will be used. 
    </p>
    <ul>
        <li> Python3 - Scripting language used to write code </li>
        <li> Pip - Python package manager </li>
        <li> Virtualenv - Python virtual environment manager</li>
    </ul>
    <ol>
        <li>
            <code>python3 --version</code> - If there is a version number Python is
            installed. If Python isn't installed follow the steps below.
        </li>
        <li><code>sudo apt install software-properties-common</code></li>
        <li><code>sudo apt-add-repositrory ppa:deadsnakes/ppa</code></li>
        <li><code>sudo apt update</code></li>
        <li><code>sudo apt install python3.10</code></li>
        <li><code>sudo apt install python3-pip</code></li>
        <li>
            <code>pip --version</code> If there is a version number pip is installed.
        </li>
        <li><code>sudo apt install python3.10-venv</code></li>
    </ol>
    <h3>4.2 <strong>Back End Creation</strong></h3>
    <p>
        4.2.1 <strong>Pip Virtual Environment</strong>
        FastAPI will be used a microservice framework for the API connection between the frontend and backend. Postgres will be used as the database. 
    </p>
    <ul>
        <li>FastAPI - Microservice framework to create APIs </li>
        <li>PostgresSQL - Database library </li>
        <li>Virtualenv - Python virtual environment manager</li>
    </ul>
    <ol>
        <li>
            <code>python3.10 -m venv ~/venv/[name_of_enviroment]</code> - This will
            create a python virtual environment.
        </li>
        <li>
            <code>source ~/venv/[name_of_enviroment]/bin/activate</code> - This will
            activate the environment.
        </li>
        <li><code>cd ~/projects/backend</code></li>
        <li><code>touch app.py setup.py requirements.txt .gitignore</code></li>
        <li>In VS code browse to backend project</li>
        <li>
            Add the following to "requirements.txt"
            <pre><code>FastAPI
    Uvicorn[standard]
    Jinja2
    Sqlalchemy
    Sqlalchemy-utils
    Pydantic
    Psycopg2-binary
    </code></pre>
            <ol>
                <li>
                    <code>pip install -r requirements.txt</code> - Ensure no errors
                    occurred.
                </li>
                <li>
                    <code>pip list</code> - This will show all installed python packages for
                    the active environment
                </li>
            </ol>
        </li>
    </ol>
    <p>4.2.2 <strong>Python Structure</strong></p>
    <ol>
        <li>
            <p>Add the following code to "setup.py"</p>
            <pre><code>import os
    
    directories = ['api','core','crud','database','models','schemas','tests']
    
    for dir in directories:
        path = f'./{dir}'
        os.mkdir(dir)
    
        file = f'{dir}.py'
        file2 = '__init__.py'
    
        open(os.path.join(path, file),'w')
        open(os.path.join(path, file2),'w')
    </code></pre>
        </li>
        <li>
            <p>
                <code>python3 setup.py</code> - This will create a base project structure.
                This is entirely personal preference on how to structure a python web app
                project, however these are some "best practices" as per community and
                documentation guidelines.
            </p>
        </li>
    </ol>
    <p>4.2.3 <strong>Run server</strong> </p>
    <ol>
    <li>Add the following code to "app.py".</li>
    <pre><code>    import uvicorn
        from fastapi import FastAPI
    
        app = FastAPI()
    
        @app.get('/')
        async def root():
            return {'message':'backend'}
    
        if __name__ == '__main__':
            uvicorn.run('app:app', host='127.0.0.1',port=5000,reload=True)
    </code></pre>

        <li><code>uvicorn app:app</code> - This will launch the FastAPI server.</li>
        <li>
            Browse to <code>localhost:8000</code> - The page should display message :
            "backend"
        </li>
    </ol>
    <hr />
    <h2>Section 5: Database</h2>
    <p>
        This section will go over the setup and creation of a Postgres database. This
        section is not required for the web app to work correctly, however to store
        any type of data this section must be completed.
    </p>
    <h3>5.1 <strong>DB install</strong></h3>
    <ol>
        <li>
            <code>sudo apt install postgresql postgresql-contrib</code> - This will
            download Postgres and its required pacakages.
        </li>
        <li>
            <code>sudo service postgresql start</code> - This will start the service for
            postgresql
        </li>
        <li>
            <code>sudo nano /etc/postgresql/14/main/postgresql.conf</code> - This file
            needs to be edited to allow for communication between backend app and DB.
        </li>
        <li>Uncomment <code>listen address="localhost"</code></li>
        <li>Replace "localhost" with "*"</li>
        <li>
            <code>sudo service postgresql restart</code> - Allow for changes to be
            updated
        </li>
        <li>
            <code>sudo service postgresql status</code> - Check to ensure server comes
            back online.
        </li>
    </ol>
    <h3>5.2 <strong>User Creation</strong></h3>
    <p>
        This section will create a user that will connect from with the Python app to
        manage the DB. </p>
<ol>
        <li><code>sudo -u postgres psql</code> - Login as admin </li>
        <li><code>CREATE USER [new_user] PASSWORD ['new_user_password'];CREATEDB;</code></li>
        <li><code>\q</code> - Exit DB as admin </li>
        <li><code>psql -U [new_user] -h 127.0.0.1 -d postgres</code> - Login as newly created user. </li>
        <li><code>\q</code> - Exit DB as new user</li>
    </ol> 
    <h3>5.3 <strong>Database Creation</strong></h3>
    <ol>
        <li><code>sudo -u [new_user] psql</code> - Login as admin</li>
        <li><code>CREATE DATABASE [new_db]</code> - Create new DB.</li>
        <li><code>\c</code> - Connect to newly created DB.</li>
        <li>
            <code>CREATE TABLE IF NOT EXISTS test(id serial, connection
          varchar(100));</code>
            - Create new table.
        </li>
        <li>
            <code>INSERT INTO test VALUES(default, 'Successfully Connected');</code> -
            Fill with test data.
        </li>
        <li><code>\q</code> - Log out.</li>
    </ol>
    <h3>5.4 <strong>Python DB Setup</strong></h3>
    <ol>
        <li>
            <p>
                In VS Code edit database &gt; database.py with the following code. The
                username and password in this file need to be the same of that created for
                the DB in the above steps.
            </p>
            <pre><code>from sqlalchemy import create_engine
    from sqlalchemy_utils import database_exists, create_database
    
    class DBConnection:
    
    def __init__(self) -&gt; None:
            self.creds = {
                'pguser':'test',
                'pgpasswd':'test',
                'pghost':'localhost',
                'pgport':5432,
                'pgdb':'test'
            }
    
    def get_engine(self,user, password, host, port, db):
        url = f'postgresql://{user}:{password}@{host}:{port}/{db}'
    
        if not database_exists(url):
            create_database(url)
    
        engine = create_engine(url, pool_size=50, echo=False)
    
        return engine
    </code></pre>
        </li>
        <li>
            <p>
                Add the following code to app.py. This will test the db connection when
                browsing to the /test uri. If connection is successful "true" will be
                displayed in the browser.
            </p>
            <pre><code>@app.get('/test')
    async def test():
        dbconn = DBConnection()
    
        engine = dbconn.get_engine(
            dbconn.creds['pguser'],
            dbconn.creds['pgpasswd'],
            dbconn.creds['pghost'],
            dbconn.creds['pgport'],
            dbconn.creds['pgdb']
        )
        print(engine.has_table('test'))
        return(engine.has_table('test'))
    </code></pre>
        </li>
    </ol>
    <hr />
    <h2>Section 6: Troubleshooting</h2>
    <h3>6.1 <strong>Front End Issues</strong></h3>
    <ol>
        <li>
            "Parsing error: No babel config file detected." - This error will be
            produced by ESLint sometimes when then the frontend project isn't the root
            directory.
        </li>
        <li>Press <code>ctrl+,</code> to open settings</li>
        <li>Search <code>ESlint</code></li>
        <li>On that page look for "Edit in settings.json"</li>
        <li>
            Add the following code block
            <pre><code>    "eslint.workingDirectories" : [
                {"mode":"auto"}
        ],
    </code></pre>
        </li>
    </ol>
    <h3>6.2 <strong>Back End Issues</strong></h3>
    <ol>
        <li>
            Unknown Python intrepreter - This issue occurs when using VS Code in
            conjunction with a python virtual environment.
        </li>
        <li><code>ctrl+shift+p</code> - This will open the command palette</li>
        <li>Search for <code>Python: Select Interpreter</code></li>
        <li>
            "Enter interpreter path.." - then browse to
            "~/venv/[name_of_environment]/bin/python3.10"
        </li>
    </ol>
    <h3>6.3 <strong>General Issues</strong></h3>
    <ol>
        <li>
            Process already running on "localhost:XXXX" - This will occur sometimes when
            restarting the app servers for both the frontend and backend applications.
        </li>
        <li>
            <code>ps aux | grep -i "name of process"</code> - vue, fast, uvicorn are
            good search criteria.
        </li>
        <li>
            Once the process has been found the first number from the left is the PID.
            Take note of this number.
        </li>
        <li><code>sudo kill -9 [PID from step 2]</code></li>
        <li>Restart server</li>
    </ol>
</body>

</html>

<style>
    body {
        background-color: rgb(201, 202, 177);
    }

    pre {
        border: 1px solid black;
    }
    code {
        font-family:Verdana, Geneva, Tahoma, sans-serif
    }
</style>

